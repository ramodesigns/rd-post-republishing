(function(a){"use strict";const b={init:function(){this.bindEvents();this.initCategorySelect()},bindEvents:function(){a(document).on("click",".wpr-dry-run-btn",this.handleDryRun.bind(this));a(document).on("click",".wpr-manual-trigger-btn",this.handleManualTrigger.bind(this));a(document).on("click",".wpr-export-history-btn",this.handleExportHistory.bind(this));a(document).on("click",".wpr-export-audit-btn",this.handleExportAudit.bind(this));a(document).on("click",".wpr-refresh-preview-btn",this.handleRefreshPreview.bind(this));a(document).on("change",'select[name="wpr_settings[category_filter_type]"]',this.toggleCategorySelect.bind(this));a(document).on("change",'select[name="wpr_settings[daily_quota_type]"]',this.updateQuotaLabel.bind(this));a(document).on("click",".nav-tab",this.handleTabClick.bind(this));a(document).on("click",".wpr-modal-close, .wpr-modal-backdrop",this.closeModal.bind(this));a(document).on("keydown",this.handleEscapeKey.bind(this))},initCategorySelect:function(){this.toggleCategorySelect()},toggleCategorySelect:function(){const c=a('select[name="wpr_settings[category_filter_type]"]').val();const d=a(".wpr-category-select-row");if(c==="none"){d.hide()}else{d.show()}},updateQuotaLabel:function(){const c=a('select[name="wpr_settings[daily_quota_type]"]').val();const d=c==="percentage"?"% of eligible posts":"posts per day";a(".wpr-quota-label").text(d)},handleTabClick:function(c){},handleDryRun:function(c){c.preventDefault();if(!confirm(wprRepublisher.i18n.confirmDryRun)){return}const d=a(c.currentTarget);this.setButtonLoading(d,true);a.ajax({url:wprRepublisher.ajaxUrl,type:"POST",data:{action:"wpr_dry_run",nonce:wprRepublisher.nonce},success:(e)=>{if(e.success){this.showDryRunResults(e.data)}else{this.showNotice("error",e.data.message||wprRepublisher.i18n.error)}},error:()=>{this.showNotice("error",wprRepublisher.i18n.error)},complete:()=>{this.setButtonLoading(d,false)}})},handleManualTrigger:function(c){c.preventDefault();if(!confirm(wprRepublisher.i18n.confirmManual)){return}const d=a(c.currentTarget);this.setButtonLoading(d,true);a.ajax({url:wprRepublisher.ajaxUrl,type:"POST",data:{action:"wpr_manual_trigger",nonce:wprRepublisher.nonce},success:(e)=>{if(e.success){this.showManualTriggerResults(e.data)}else{this.showNotice("error",e.data.message||wprRepublisher.i18n.error)}},error:()=>{this.showNotice("error",wprRepublisher.i18n.error)},complete:()=>{this.setButtonLoading(d,false)}})},handleExportHistory:function(c){c.preventDefault();const d=a(c.currentTarget);this.setButtonLoading(d,true);a.ajax({url:wprRepublisher.ajaxUrl,type:"POST",data:{action:"wpr_export_history",nonce:wprRepublisher.nonce},success:(e)=>{if(e.success){this.downloadCSV(e.data.csv,e.data.filename);this.showNotice("success","History exported successfully.")}else{this.showNotice("error",e.data.message||wprRepublisher.i18n.error)}},error:()=>{this.showNotice("error",wprRepublisher.i18n.error)},complete:()=>{this.setButtonLoading(d,false)}})},handleExportAudit:function(c){c.preventDefault();const d=a(c.currentTarget);this.setButtonLoading(d,true);a.ajax({url:wprRepublisher.ajaxUrl,type:"POST",data:{action:"wpr_export_audit",nonce:wprRepublisher.nonce},success:(e)=>{if(e.success){this.downloadCSV(e.data.csv,e.data.filename);this.showNotice("success","Audit log exported successfully.")}else{this.showNotice("error",e.data.message||wprRepublisher.i18n.error)}},error:()=>{this.showNotice("error",wprRepublisher.i18n.error)},complete:()=>{this.setButtonLoading(d,false)}})},handleRefreshPreview:function(c){c.preventDefault();const d=a(c.currentTarget);const e=a(".wpr-preview-list");this.setButtonLoading(d,true);e.addClass("wpr-loading");a.ajax({url:wprRepublisher.ajaxUrl,type:"POST",data:{action:"wpr_get_preview",nonce:wprRepublisher.nonce},success:(f)=>{if(f.success){this.updatePreviewList(f.data)}else{this.showNotice("error",f.data.message||wprRepublisher.i18n.error)}},error:()=>{this.showNotice("error",wprRepublisher.i18n.error)},complete:()=>{this.setButtonLoading(d,false);e.removeClass("wpr-loading")}})},showDryRunResults:function(c){let d='<div class="wpr-modal"><div class="wpr-modal-backdrop"></div><div class="wpr-modal-content"><button type="button" class="wpr-modal-close">&times;</button><h2>Dry-Run Results</h2><p class="wpr-modal-message">'+c.message+"</p>";if(c.posts&&c.posts.length>0){d+='<table class="widefat striped"><thead><tr><th>ID</th><th>Title</th><th>Current Date</th><th>Actions</th></tr></thead><tbody>';c.posts.forEach(function(e){d+="<tr><td>"+e.id+"</td><td>"+e.title+"</td><td>"+e.current_date+'</td><td><a href="'+e.edit_link+'" target="_blank" class="button button-small">Edit</a> <a href="'+e.view_link+'" target="_blank" class="button button-small">View</a></td></tr>'});d+="</tbody></table>"}else{d+="<p>No posts would be republished with current settings.</p>"}d+="</div></div>";a("body").append(d)},showManualTriggerResults:function(c){let d='<div class="wpr-modal"><div class="wpr-modal-backdrop"></div><div class="wpr-modal-content"><button type="button" class="wpr-modal-close">&times;</button><h2>Republishing Complete</h2><p class="wpr-modal-message">'+c.message+'</p><div class="wpr-results-summary"><div class="wpr-result-item success"><span class="count">'+c.republished.length+'</span><span class="label">Republished</span></div><div class="wpr-result-item warning"><span class="count">'+c.skipped.length+'</span><span class="label">Skipped</span></div><div class="wpr-result-item error"><span class="count">'+c.failed.length+'</span><span class="label">Failed</span></div></div>';if(c.republished&&c.republished.length>0){d+='<h3>Republished Posts</h3><ul class="wpr-post-list">';c.republished.forEach(function(e){d+="<li>Post ID: "+e+"</li>"});d+="</ul>"}if(c.failed&&c.failed.length>0){d+='<h3>Failed Posts</h3><ul class="wpr-post-list error">';c.failed.forEach(function(e){d+="<li>Post ID: "+e+"</li>"});d+="</ul>"}d+="</div></div>";a("body").append(d)},updatePreviewList:function(c){const d=a(".wpr-preview-list");if(!d.length){return}let e="";if(c.posts&&c.posts.length>0){e+='<p class="wpr-preview-summary">Showing '+c.posts.length+" of "+c.total_count+" eligible posts (daily quota: "+c.quota+')</p><table class="widefat striped"><thead><tr><th>ID</th><th>Title</th><th>Current Date</th><th>Categories</th></tr></thead><tbody>';c.posts.forEach(function(f){e+="<tr><td>"+f.id+"</td><td>"+f.title+"</td><td>"+f.current_date+"</td><td>"+(f.categories?f.categories.join(", "):"-")+"</td></tr>"});e+="</tbody></table>"}else{e="<p>No eligible posts found with current settings.</p>"}d.html(e)},closeModal:function(c){if(c){c.preventDefault()}a(".wpr-modal").remove()},handleEscapeKey:function(c){if(c.key==="Escape"&&a(".wpr-modal").length){this.closeModal()}},downloadCSV:function(c,d){const e=new Blob([c],{type:"text/csv;charset=utf-8;"});const f=document.createElement("a");if(navigator.msSaveBlob){navigator.msSaveBlob(e,d)}else{f.href=URL.createObjectURL(e);f.setAttribute("download",d);f.style.visibility="hidden";document.body.appendChild(f);f.click();document.body.removeChild(f)}},setButtonLoading:function(c,d){if(d){c.addClass("wpr-loading").prop("disabled",true);c.data("original-text",c.text());c.html('<span class="spinner is-active"></span> Loading...')}else{c.removeClass("wpr-loading").prop("disabled",false);c.text(c.data("original-text")||"Submit")}},showNotice:function(c,d){const e=c==="error"?"notice-error":"notice-success";const f=a('<div class="notice '+e+' is-dismissible"><p>'+d+"</p></div>");a(".wpr-admin-notice").remove();f.addClass("wpr-admin-notice");a(".wrap h1").first().after(f);a(document).trigger("wp-updates-notice-added");setTimeout(function(){f.fadeOut(function(){a(this).remove()})},5000)}};a(document).ready(function(){b.init()})})(jQuery);
