Plugin Architecture
File Structure
wp-post-republisher/
├── wp-post-republisher.php (Main plugin file)
├── includes/
│   ├── class-wp-post-republisher.php (Core plugin class)
│   ├── class-admin.php (Admin interface handler)
│   ├── class-scheduler.php (Cron and scheduling logic)
│   ├── class-republisher.php (Post republishing engine)
│   ├── class-api.php (REST API endpoints)
│   ├── class-database.php (Database operations)
│   └── class-logger.php (Logging and audit functionality)
├── admin/
│   ├── css/admin-styles.css
│   ├── js/admin-scripts.js
│   └── views/
│       ├── overview.php
│       ├── schedule.php
│       ├── settings.php
│       └── logs.php
├── assets/
│   ├── css/
│   └── js/
└── languages/
    └── wp-post-republisher.pot
Database Schema Specifications
Table 1: Plugin Settings
CREATE TABLE {prefix}wp_post_republisher_settings (
    id int(11) NOT NULL AUTO_INCREMENT,
    option_name varchar(255) NOT NULL,
    option_value longtext,
    autoload enum('yes','no') DEFAULT 'yes',
    PRIMARY KEY (id),
    UNIQUE KEY option_name (option_name)
);
Settings Keys Structure:

enabled_post_types: JSON array of enabled post type slugs
daily_quota_type: enum('number', 'percentage')
daily_quota_value: int (1-50 for number, 1-100 for percentage)
republish_start_hour: int(0-23)
republish_end_hour: int(0-23)
minimum_age_days: int(7-180)
maintain_chronological_order: bool
category_filter_type: enum('none', 'whitelist', 'blacklist')
category_filter_ids: JSON array of category IDs
wp_cron_enabled: bool
api_rate_limit_seconds: int
debug_mode: bool
dry_run_mode: bool
Table 2: Republishing History
CREATE TABLE {prefix}wp_post_republisher_history (
    id bigint(20) NOT NULL AUTO_INCREMENT,
    post_id bigint(20) NOT NULL,
    post_type varchar(20) NOT NULL,
    original_date datetime NOT NULL,
    republish_date datetime NOT NULL,
    status enum('success', 'failed', 'retrying') NOT NULL,
    error_message text,
    execution_time float,
    triggered_by enum('cron', 'api', 'manual') NOT NULL,
    created_at datetime DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    KEY post_id (post_id),
    KEY republish_date (republish_date),
    KEY status (status),
    KEY created_at (created_at)
);
Table 3: Audit Log
CREATE TABLE {prefix}wp_post_republisher_audit (
    id bigint(20) NOT NULL AUTO_INCREMENT,
    user_id bigint(20) NOT NULL,
    action varchar(100) NOT NULL,
    setting_key varchar(255),
    old_value text,
    new_value text,
    ip_address varchar(45),
    user_agent text,
    timestamp datetime DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    KEY user_id (user_id),
    KEY action (action),
    KEY timestamp (timestamp)
);
Table 4: API Rate Limiting
CREATE TABLE {prefix}wp_post_republisher_api_log (
    id bigint(20) NOT NULL AUTO_INCREMENT,
    ip_address varchar(45) NOT NULL,
    user_id bigint(20),
    endpoint varchar(100) NOT NULL,
    response_code int(3) NOT NULL,
    request_timestamp datetime DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    KEY ip_address (ip_address),
    KEY request_timestamp (request_timestamp)
);
WordPress Hooks Integration
Plugin Activation/Deactivation
// Activation Hook
register_activation_hook(__FILE__, array('WP_Post_Republisher', 'activate'));
// Deactivation Hook
register_deactivation_hook(__FILE__, array('WP_Post_Republisher', 'deactivate'));
// Uninstall Hook
register_uninstall_hook(__FILE__, array('WP_Post_Republisher', 'uninstall'));
WordPress Cron Integration
// Custom cron interval
add_filter('cron_schedules', function($schedules) {
    $schedules['wp_post_republisher_daily'] = array(
        'interval' => DAY_IN_SECONDS,
        'display'  => __('Daily (Post Republisher)', 'wp-post-republisher')
    );
    return $schedules;
});
// Cron event hook
add_action('wp_post_republisher_daily_event', array('WP_Post_Republisher_Scheduler', 'execute_daily_republishing'));
// Retry cron event hook
add_action('wp_post_republisher_retry_event', array('WP_Post_Republisher_Scheduler', 'execute_retry_republishing'));
Post Republishing Hooks
// Before republishing a post
do_action('wp_post_republisher_before_republish', $post_id, $post_data);
// After successful republishing
do_action('wp_post_republisher_after_republish', $post_id, $old_date, $new_date);
// On republishing failure
do_action('wp_post_republisher_republish_failed', $post_id, $error_message);
// WordPress core hooks to trigger
add_action('publish_post', array('WP_Post_Republisher_Cache', 'clear_post_cache'));
add_action('wp_insert_post', array('WP_Post_Republisher_Cache', 'clear_related_cache'));
Admin Interface Hooks
// Admin menu
add_action('admin_menu', array('WP_Post_Republisher_Admin', 'add_admin_menu'));
// Admin scripts and styles
add_action('admin_enqueue_scripts', array('WP_Post_Republisher_Admin', 'enqueue_admin_assets'));
// AJAX hooks
add_action('wp_ajax_wp_post_republisher_dry_run', array('WP_Post_Republisher_Admin', 'ajax_dry_run'));
add_action('wp_ajax_wp_post_republisher_manual_trigger', array('WP_Post_Republisher_Admin', 'ajax_manual_trigger'));
REST API Technical Specifications
API Endpoint Registration
// REST API namespace: wp-post-republisher/v1
add_action('rest_api_init', function() {
    register_rest_route('wp-post-republisher/v1', '/trigger', array(
        'methods'             => 'POST',
        'callback'            => array('WP_Post_Republisher_API', 'trigger_republishing'),
        'permission_callback' => array('WP_Post_Republisher_API', 'verify_permissions'),
        'args'                => array(
            'force' => array(
                'type'        => 'boolean',
                'default'     => false,
                'description' => 'Force republishing even if already done today'
            )
        )
    ));
});
API Authentication
// Application Password verification
public function verify_permissions($request) {
    $current_user = wp_get_current_user();
    
    // Check if user is authenticated via Application Password
    if (!$current_user->exists()) {
        return new WP_Error('rest_forbidden', 'Authentication required', array('status' => 401));
    }
    
    // Verify administrator capability
    if (!user_can($current_user, 'manage_options')) {
        return new WP_Error('rest_forbidden', 'Administrator access required', array('status' => 403));
    }
    
    return true;
}
Core Class Specifications
Main Plugin Class: WP_Post_Republisher
class WP_Post_Republisher {
    
    private static $instance = null;
    private $admin;
    private $scheduler;
    private $republisher;
    private $database;
    private $logger;
    
    // Singleton pattern
    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    // Plugin initialization
    public function init() {
        $this->load_dependencies();
        $this->init_hooks();
        $this->maybe_upgrade_database();
    }
    
    // Database activation
    public static function activate() {
        self::create_database_tables();
        self::schedule_daily_cron();
        self::set_default_options();
    }
}
Republisher Engine Class: WP_Post_Republisher_Republisher
class WP_Post_Republisher_Republisher {
    
    // Main republishing function
    public function republish_posts($post_ids, $options = array()) {
        $results = array();
        
        foreach ($post_ids as $post_id) {
            $result = $this->republish_single_post($post_id, $options);
            $results[] = $result;
            
            // Trigger WordPress hooks
            if ($result['status'] === 'success') {
                do_action('wp_post_republisher_after_republish', $post_id, $result['old_date'], $result['new_date']);
                $this->clear_post_cache($post_id);
            } else {
                do_action('wp_post_republisher_republish_failed', $post_id, $result['error']);
            }
        }
        
        return $results;
    }
    
    // Single post republishing
    private function republish_single_post($post_id, $options) {
        global $wpdb;
        
        $post = get_post($post_id);
        if (!$post) {
            return array('status' => 'failed', 'error' => 'Post not found');
        }
        
        $old_date = $post->post_date;
        $new_date = $this->generate_random_publish_time($options);
        
        // Update post dates
        $update_result = $wpdb->update(
            $wpdb->posts,
            array(
                'post_date'     => $new_date,
                'post_date_gmt' => get_gmt_from_date($new_date),
                'post_modified' => current_time('mysql'),
                'post_modified_gmt' => current_time('mysql', 1)
            ),
            array('ID' => $post_id),
            array('%s', '%s', '%s', '%s'),
            array('%d')
        );
        
        if ($update_result === false) {
            return array('status' => 'failed', 'error' => 'Database update failed');
        }
        
        // Clear WordPress cache
        clean_post_cache($post_id);
        wp_cache_delete($post_id, 'posts');
        
        return array(
            'status' => 'success',
            'post_id' => $post_id,
            'old_date' => $old_date,
            'new_date' => $new_date
        );
    }
}
Post Selection Query Class
class WP_Post_Republisher_Query {
    
    // Get eligible posts for republishing
    public function get_eligible_posts($limit, $post_types, $min_age_days) {
        global $wpdb;
        
        $post_types_placeholder = implode("','", array_map('esc_sql', $post_types));
        $min_date = date('Y-m-d H:i:s', strtotime("-{$min_age_days} days"));
        
        // Exclude already republished today
        $today_start = date('Y-m-d 00:00:00');
        $today_end = date('Y-m-d 23:59:59');
        
        $query = "
            SELECT p.ID, p.post_date, p.post_type, p.post_title
            FROM {$wpdb->posts} p
            LEFT JOIN {$wpdb->prefix}wp_post_republisher_history h 
                ON p.ID = h.post_id 
                AND h.republish_date BETWEEN %s AND %s 
                AND h.status = 'success'
            WHERE p.post_status = 'publish'
                AND p.post_type IN ('{$post_types_placeholder}')
                AND p.post_date < %s
                AND h.id IS NULL
            ORDER BY p.post_date ASC
            LIMIT %d
        ";
        
        return $wpdb->get_results(
            $wpdb->prepare($query, $today_start, $today_end, $min_date, $limit)
        );
    }
}
Scheduler Implementation
Cron Management Class: WP_Post_Republisher_Scheduler
class WP_Post_Republisher_Scheduler {
    
    // Schedule daily republishing
    public static function schedule_daily_cron() {
        if (!wp_next_scheduled('wp_post_republisher_daily_event')) {
            wp_schedule_event(time(), 'wp_post_republisher_daily', 'wp_post_republisher_daily_event');
        }
    }
    
    // Execute daily republishing
    public static function execute_daily_republishing() {
        $republisher = new WP_Post_Republisher_Republisher();
        $query = new WP_Post_Republisher_Query();
        $logger = new WP_Post_Republisher_Logger();
        
        // Get settings
        $settings = get_option('wp_post_republisher_settings', array());
        
        // Get eligible posts
        $posts = $query->get_eligible_posts(
            $settings['daily_quota_value'],
            $settings['enabled_post_types'],
            $settings['minimum_age_days']
        );
        
        if (empty($posts)) {
            $logger->log_republishing_event(array(), 'No eligible posts found', 'cron');
            return;
        }
        
        // Extract post IDs
        $post_ids = wp_list_pluck($posts, 'ID');
        
        // Execute republishing
        $results = $republisher->republish_posts($post_ids, $settings);
        
        // Log results
        $logger->log_republishing_results($results, 'cron');
        
        // Schedule retry for failed posts
        $failed_ids = array();
        foreach ($results as $result) {
            if ($result['status'] === 'failed') {
                $failed_ids[] = $result['post_id'];
            }
        }
        
        if (!empty($failed_ids)) {
            $this->schedule_retry($failed_ids);
        }
    }
}
Security Implementation
Nonce Verification
// Admin form submissions
public function verify_admin_nonce($action) {
    if (!isset($_POST['wp_post_republisher_nonce']) || 
        !wp_verify_nonce($_POST['wp_post_republisher_nonce'], $action)) {
        wp_die(__('Security check failed', 'wp-post-republisher'));
    }
}
// AJAX requests
public function verify_ajax_nonce() {
    check_ajax_referer('wp_post_republisher_ajax', 'nonce');
}
Input Sanitization
public function sanitize_settings($input) {
    $sanitized = array();
    
    $sanitized['enabled_post_types'] = array_map('sanitize_text_field', (array) $input['enabled_post_types']);
    $sanitized['daily_quota_type'] = in_array($input['daily_quota_type'], array('number', 'percentage')) 
        ? $input['daily_quota_type'] : 'number';
    $sanitized['daily_quota_value'] = absint($input['daily_quota_value']);
    $sanitized['republish_start_hour'] = max(0, min(23, absint($input['republish_start_hour'])));
    $sanitized['republish_end_hour'] = max(0, min(23, absint($input['republish_end_hour'])));
    
    return $sanitized;
}
Cache Integration
Cache Management Class
class WP_Post_Republisher_Cache {
    
    // Clear post-specific cache
    public static function clear_post_cache($post_id) {
        // WordPress core cache
        clean_post_cache($post_id);
        wp_cache_delete($post_id, 'posts');
        
        // Popular caching plugins
        if (function_exists('wp_cache_flush')) {
            wp_cache_flush();
        }
        
        // WP Rocket
        if (function_exists('rocket_clean_post')) {
            rocket_clean_post($post_id);
        }
        
        // W3 Total Cache
        if (function_exists('w3tc_pgcache_flush_post')) {
            w3tc_pgcache_flush_post($post_id);
        }
        
        // WP Super Cache
        if (function_exists('wp_cache_post_change')) {
            wp_cache_post_change($post_id);
        }
    }
}
Database Maintenance
Cleanup Cron Job
// Daily cleanup of old records
add_action('wp_post_republisher_cleanup_event', function() {
    global $wpdb;
    
    $retention_days = 365;
    $cutoff_date = date('Y-m-d H:i:s', strtotime("-{$retention_days} days"));
    
    // Clean history table
    $wpdb->query($wpdb->prepare("
        DELETE FROM {$wpdb->prefix}wp_post_republisher_history 
        WHERE created_at < %s
    ", $cutoff_date));
    
    // Clean audit table
    $wpdb->query($wpdb->prepare("
        DELETE FROM {$wpdb->prefix}wp_post_republisher_audit 
        WHERE timestamp < %s
    ", $cutoff_date));
    
    // Clean API log table
    $wpdb->query($wpdb->prepare("
        DELETE FROM {$wpdb->prefix}wp_post_republisher_api_log 
        WHERE request_timestamp < %s
    ", $cutoff_date));
});